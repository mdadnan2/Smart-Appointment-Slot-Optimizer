generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  USER
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum ShiftType {
  MORNING
  EVENING
  FULL_DAY
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(USER)
  phone     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  appointments Appointment[]
  provider     Provider?

  @@map("users")
}

model Provider {
  id                     String   @id @default(uuid())
  userId                 String   @unique
  specialty              String
  timezone               String   @default("UTC")
  defaultServiceDuration Int      @default(30) // minutes
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workingHours WorkingHour[]
  breaks       Break[]
  services     Service[]
  appointments Appointment[]
  holidays     Holiday[]

  @@map("providers")
}

model WorkingHour {
  id         String    @id @default(uuid())
  providerId String
  dayOfWeek  DayOfWeek
  shiftType  ShiftType @default(FULL_DAY)
  startTime  String // HH:mm format (e.g., "09:00")
  endTime    String // HH:mm format (e.g., "18:00")
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  provider Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@map("working_hours")
}

model Break {
  id         String   @id @default(uuid())
  providerId String
  title      String
  startTime  DateTime
  endTime    DateTime
  isRecurring Boolean @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  provider Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@map("breaks")
}

model Holiday {
  id          String   @id @default(uuid())
  providerId  String
  title       String
  date        DateTime @db.Date
  isRecurring Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  provider Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@map("holidays")
}

model Service {
  id          String   @id @default(uuid())
  providerId  String
  name        String
  duration    Int // minutes
  price       Float?
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  provider     Provider      @relation(fields: [providerId], references: [id], onDelete: Cascade)
  appointments Appointment[]

  @@map("services")
}

model Appointment {
  id         String            @id @default(uuid())
  providerId String
  userId     String
  serviceId  String
  startTime  DateTime
  endTime    DateTime
  status     AppointmentStatus @default(PENDING)
  notes      String?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt

  provider Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  service  Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([providerId, startTime, endTime])
  @@map("appointments")
}
